
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Interactivo - Carwash Peña Blanca</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        .dashboard-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            transition: transform 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .filter-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .chart-type-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .export-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .export-btn:hover {
            transform: scale(1.05);
            color: white;
        }
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="/static/IMG-20250624-WA0043_1752632246954.jpg" alt="Carwash Peña Blanca" height="40" class="me-2">
                <span><i class="fas fa-car me-2"></i>Carwash Peña Blanca</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="/dashboard"><i class="fas fa-tachometer-alt me-1"></i>Dashboard</a>
                    <a class="nav-link" href="/products"><i class="fas fa-box me-1"></i>Inventario</a>
                    <a class="nav-link" href="/customers"><i class="fas fa-users me-1"></i>Clientes</a>
                    <a class="nav-link" href="/sales"><i class="fas fa-shopping-cart me-1"></i>Ventas</a>
                    <a class="nav-link" href="/sales/new"><i class="fas fa-plus me-1"></i>Nueva Venta</a>
                    <a class="nav-link active" href="/reports"><i class="fas fa-chart-bar me-1"></i>Reportes</a>
                    <a class="nav-link text-warning" href="/system_logout"><i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesión</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-4 fw-bold text-center mb-4">
                    <i class="fas fa-chart-line me-3"></i>Dashboard Interactivo
                </h1>
                <p class="lead text-center text-muted">Análisis completo de tu negocio en tiempo real</p>
            </div>
        </div>

        <!-- Filtros y Controles -->
        <div class="filter-section">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <label class="form-label fw-bold">Período:</label>
                    <select class="form-select" id="periodFilter">
                        <option value="7">Últimos 7 días</option>
                        <option value="30" selected>Últimos 30 días</option>
                        <option value="90">Últimos 90 días</option>
                        <option value="365">Último año</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Categoría:</label>
                    <select class="form-select" id="categoryFilter">
                        <option value="all">Todas las categorías</option>
                        <option value="Servicios">Servicios</option>
                        <option value="Productos">Productos</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Actualizar:</label>
                    <button class="btn btn-light w-100" onclick="refreshData()">
                        <i class="fas fa-sync-alt me-2"></i>Actualizar Datos
                    </button>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Exportar:</label>
                    <div class="d-flex gap-2">
                        <a href="/reports/sales_excel" class="btn export-btn flex-fill">
                            <i class="fas fa-file-excel me-1"></i>Ventas
                        </a>
                        <a href="/reports/inventory_excel" class="btn export-btn flex-fill">
                            <i class="fas fa-boxes me-1"></i>Stock
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Métricas Principales -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Ingresos Totales</h6>
                            <h2 id="totalRevenue">L. 0.00</h2>
                            <small id="revenueChange">+0% vs período anterior</small>
                        </div>
                        <i class="fas fa-dollar-sign fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Ventas Totales</h6>
                            <h2 id="totalSales">0</h2>
                            <small id="salesChange">+0% vs período anterior</small>
                        </div>
                        <i class="fas fa-shopping-cart fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Ticket Promedio</h6>
                            <h2 id="avgTicket">L. 0.00</h2>
                            <small id="ticketChange">+0% vs período anterior</small>
                        </div>
                        <i class="fas fa-receipt fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Clientes Activos</h6>
                            <h2 id="activeCustomers">0</h2>
                            <small id="customersChange">+0% vs período anterior</small>
                        </div>
                        <i class="fas fa-users fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestañas de Análisis -->
        <ul class="nav nav-pills mb-4" id="analysisTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="sales-tab" data-bs-toggle="pill" data-bs-target="#sales-panel" type="button">
                    <i class="fas fa-chart-line me-2"></i>Análisis de Ventas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="products-tab" data-bs-toggle="pill" data-bs-target="#products-panel" type="button">
                    <i class="fas fa-box me-2"></i>Análisis de Productos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="customers-tab" data-bs-toggle="pill" data-bs-target="#customers-panel" type="button">
                    <i class="fas fa-users me-2"></i>Análisis de Clientes
                </button>
            </li>
        </ul>

        <div class="tab-content" id="analysisTabContent">
            <!-- Panel de Ventas -->
            <div class="tab-pane fade show active" id="sales-panel" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card dashboard-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-chart-line me-2"></i>Tendencia de Ventas</h5>
                                <div class="chart-type-selector">
                                    <select class="form-select form-select-sm" id="salesChartType">
                                        <option value="line">Líneas</option>
                                        <option value="bar">Barras</option>
                                        <option value="area">Área</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="salesTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card dashboard-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-credit-card me-2"></i>Métodos de Pago</h5>
                                <div class="chart-type-selector">
                                    <select class="form-select form-select-sm" id="paymentChartType">
                                        <option value="doughnut">Dona</option>
                                        <option value="pie">Circular</option>
                                        <option value="bar">Barras</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="paymentMethodChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5><i class="fas fa-calendar-alt me-2"></i>Ventas por Día de la Semana</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="weekdayChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de Productos -->
            <div class="tab-pane fade" id="products-panel" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card dashboard-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-star me-2"></i>Top Productos</h5>
                                <div class="chart-type-selector">
                                    <select class="form-select form-select-sm" id="topProductsChartType">
                                        <option value="bar">Barras</option>
                                        <option value="horizontalBar">Barras Horizontales</option>
                                        <option value="radar">Radar</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="topProductsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card dashboard-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-layer-group me-2"></i>Ventas por Categoría</h5>
                                <div class="chart-type-selector">
                                    <select class="form-select form-select-sm" id="categoryChartType">
                                        <option value="doughnut">Dona</option>
                                        <option value="pie">Circular</option>
                                        <option value="polarArea">Área Polar</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="categorySalesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5><i class="fas fa-boxes me-2"></i>Análisis de Inventario</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="inventoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de Clientes -->
            <div class="tab-pane fade" id="customers-panel" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5><i class="fas fa-user-plus me-2"></i>Nuevos Clientes</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="newCustomersChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5><i class="fas fa-heart me-2"></i>Fidelidad de Clientes</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="customerLoyaltyChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales para los gráficos
        let charts = {};
        let chartData = {};

        // Configuración de colores
        const colorSchemes = {
            primary: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'],
            secondary: ['#11998e', '#38ef7d', '#fc466b', '#3f5efb', '#fa709a', '#fee140'],
            gradient: ['rgba(102, 126, 234, 0.8)', 'rgba(118, 75, 162, 0.8)', 'rgba(240, 147, 251, 0.8)']
        };

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Filtros
            document.getElementById('periodFilter').addEventListener('change', refreshData);
            document.getElementById('categoryFilter').addEventListener('change', refreshData);

            // Selectores de tipo de gráfico
            document.getElementById('salesChartType').addEventListener('change', updateSalesChart);
            document.getElementById('paymentChartType').addEventListener('change', updatePaymentChart);
            document.getElementById('topProductsChartType').addEventListener('change', updateTopProductsChart);
            document.getElementById('categoryChartType').addEventListener('change', updateCategoryChart);
        }

        async function loadDashboardData() {
            try {
                const period = document.getElementById('periodFilter').value;
                const category = document.getElementById('categoryFilter').value;
                
                // Simular llamada a API con datos más complejos
                const response = await fetch(`/api/dashboard_data?period=${period}&category=${category}`);
                const data = await response.json();
                
                // Almacenar datos
                chartData = data;
                
                // Actualizar métricas
                updateMetrics(data);
                
                // Crear todos los gráficos
                createAllCharts(data);
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                createAllCharts({}); // Crear gráficos vacíos
            }
        }

        function updateMetrics(data) {
            const salesData = data.daily_sales || [];
            const totalRevenue = salesData.reduce((sum, item) => sum + (item.total || 0), 0);
            const totalSales = salesData.length;
            const avgTicket = totalSales > 0 ? totalRevenue / totalSales : 0;
            
            document.getElementById('totalRevenue').textContent = `L. ${totalRevenue.toLocaleString('es-HN', {minimumFractionDigits: 2})}`;
            document.getElementById('totalSales').textContent = totalSales.toLocaleString();
            document.getElementById('avgTicket').textContent = `L. ${avgTicket.toLocaleString('es-HN', {minimumFractionDigits: 2})}`;
            document.getElementById('activeCustomers').textContent = '15'; // Simulado
        }

        function createAllCharts(data) {
            createSalesTrendChart(data.daily_sales || []);
            createPaymentMethodChart(data.payment_methods || []);
            createWeekdayChart(data.weekday_sales || []);
            createTopProductsChart(data.top_products || []);
            createCategorySalesChart(data.category_sales || []);
            createInventoryChart(data.inventory_status || []);
            createNewCustomersChart(data.new_customers || []);
            createCustomerLoyaltyChart(data.customer_loyalty || []);
        }

        function createSalesTrendChart(data) {
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            destroyChart('salesTrend');
            
            charts.salesTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(item => new Date(item.date).toLocaleDateString('es-HN')),
                    datasets: [{
                        label: 'Ventas Diarias (L.)',
                        data: data.map(item => item.total || 0),
                        borderColor: colorSchemes.primary[0],
                        backgroundColor: colorSchemes.gradient[0],
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'L. ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }

        function createPaymentMethodChart(data) {
            const ctx = document.getElementById('paymentMethodChart').getContext('2d');
            destroyChart('paymentMethod');
            
            // Datos simulados si no hay datos reales
            const paymentData = data.length > 0 ? data : [
                {method: 'Efectivo', total: 15000},
                {method: 'Tarjeta', total: 8500},
                {method: 'Transferencia', total: 4200}
            ];
            
            charts.paymentMethod = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: paymentData.map(item => item.method),
                    datasets: [{
                        data: paymentData.map(item => item.total),
                        backgroundColor: colorSchemes.primary.slice(0, paymentData.length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createWeekdayChart(data) {
            const ctx = document.getElementById('weekdayChart').getContext('2d');
            destroyChart('weekday');
            
            const weekdays = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
            const weekdayData = weekdays.map((day, index) => ({
                day: day,
                sales: Math.floor(Math.random() * 5000) + 2000 // Datos simulados
            }));
            
            charts.weekday = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weekdayData.map(item => item.day),
                    datasets: [{
                        label: 'Ventas por Día',
                        data: weekdayData.map(item => item.sales),
                        backgroundColor: colorSchemes.secondary
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createTopProductsChart(data) {
            const ctx = document.getElementById('topProductsChart').getContext('2d');
            destroyChart('topProducts');
            
            const productData = data.length > 0 ? data : [
                {name: 'Lavado Premium', quantity: 45},
                {name: 'Lavado Básico', quantity: 38},
                {name: 'Lavado Completo', quantity: 32},
                {name: 'Encerado', quantity: 25},
                {name: 'Shampuseado', quantity: 18}
            ];
            
            charts.topProducts = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: productData.map(item => item.name),
                    datasets: [{
                        label: 'Cantidad Vendida',
                        data: productData.map(item => item.quantity),
                        backgroundColor: colorSchemes.primary
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createCategorySalesChart(data) {
            const ctx = document.getElementById('categorySalesChart').getContext('2d');
            destroyChart('categorySales');
            
            const categoryData = data.length > 0 ? data : [
                {category: 'Servicios', total: 18500},
                {category: 'Productos', total: 7200}
            ];
            
            charts.categorySales = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.map(item => item.category),
                    datasets: [{
                        data: categoryData.map(item => item.total),
                        backgroundColor: colorSchemes.secondary.slice(0, categoryData.length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createInventoryChart(data) {
            const ctx = document.getElementById('inventoryChart').getContext('2d');
            destroyChart('inventory');
            
            // Datos simulados de inventario
            const inventoryData = [
                {product: 'Shampoo Auto', stock: 45, min_stock: 20},
                {product: 'Cera Líquida', stock: 28, min_stock: 15},
                {product: 'Toalla Microfibra', stock: 12, min_stock: 10},
                {product: 'Cepillo Ruedas', stock: 35, min_stock: 25}
            ];
            
            charts.inventory = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: inventoryData.map(item => item.product),
                    datasets: [{
                        label: 'Stock Actual',
                        data: inventoryData.map(item => item.stock),
                        backgroundColor: colorSchemes.primary[0]
                    }, {
                        label: 'Stock Mínimo',
                        data: inventoryData.map(item => item.min_stock),
                        backgroundColor: colorSchemes.primary[3]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createNewCustomersChart(data) {
            const ctx = document.getElementById('newCustomersChart').getContext('2d');
            destroyChart('newCustomers');
            
            // Datos simulados de nuevos clientes
            const newCustomersData = [
                {month: 'Ene', customers: 8},
                {month: 'Feb', customers: 12},
                {month: 'Mar', customers: 15},
                {month: 'Abr', customers: 10},
                {month: 'May', customers: 18},
                {month: 'Jun', customers: 22}
            ];
            
            charts.newCustomers = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: newCustomersData.map(item => item.month),
                    datasets: [{
                        label: 'Nuevos Clientes',
                        data: newCustomersData.map(item => item.customers),
                        borderColor: colorSchemes.secondary[0],
                        backgroundColor: colorSchemes.gradient[1],
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createCustomerLoyaltyChart(data) {
            const ctx = document.getElementById('customerLoyaltyChart').getContext('2d');
            destroyChart('customerLoyalty');
            
            const loyaltyData = [
                {segment: 'Nuevos (1 visita)', count: 25},
                {segment: 'Ocasionales (2-5)', count: 18},
                {segment: 'Regulares (6-15)', count: 12},
                {segment: 'Fieles (16+)', count: 8}
            ];
            
            charts.customerLoyalty = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: loyaltyData.map(item => item.segment),
                    datasets: [{
                        data: loyaltyData.map(item => item.count),
                        backgroundColor: colorSchemes.primary
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Funciones para actualizar tipos de gráficos
        function updateSalesChart() {
            const type = document.getElementById('salesChartType').value;
            destroyChart('salesTrend');
            
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            const data = chartData.daily_sales || [];
            
            let config = {
                type: type === 'area' ? 'line' : type,
                data: {
                    labels: data.map(item => new Date(item.date).toLocaleDateString('es-HN')),
                    datasets: [{
                        label: 'Ventas Diarias (L.)',
                        data: data.map(item => item.total || 0),
                        borderColor: colorSchemes.primary[0],
                        backgroundColor: type === 'area' ? colorSchemes.gradient[0] : colorSchemes.primary[0]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };
            
            if (type === 'area') {
                config.data.datasets[0].fill = true;
                config.data.datasets[0].tension = 0.4;
            }
            
            charts.salesTrend = new Chart(ctx, config);
        }

        function updatePaymentChart() {
            const type = document.getElementById('paymentChartType').value;
            destroyChart('paymentMethod');
            createPaymentMethodChart(chartData.payment_methods || []);
            charts.paymentMethod.config.type = type;
            charts.paymentMethod.update();
        }

        function updateTopProductsChart() {
            const type = document.getElementById('topProductsChartType').value;
            destroyChart('topProducts');
            createTopProductsChart(chartData.top_products || []);
            
            if (type === 'horizontalBar') {
                charts.topProducts.config.options.indexAxis = 'y';
            } else {
                charts.topProducts.config.options.indexAxis = 'x';
            }
            
            charts.topProducts.config.type = type === 'horizontalBar' ? 'bar' : type;
            charts.topProducts.update();
        }

        function updateCategoryChart() {
            const type = document.getElementById('categoryChartType').value;
            destroyChart('categorySales');
            createCategorySalesChart(chartData.category_sales || []);
            charts.categorySales.config.type = type;
            charts.categorySales.update();
        }

        function destroyChart(chartName) {
            if (charts[chartName]) {
                charts[chartName].destroy();
            }
        }

        function refreshData() {
            // Mostrar indicador de carga
            document.querySelectorAll('canvas').forEach(canvas => {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('Actualizando...', canvas.width / 2, canvas.height / 2);
            });
            
            // Recargar datos
            setTimeout(() => {
                loadDashboardData();
            }, 500);
        }
    </script>
</body>
</html>
